<!--Static table from csv file-->
<table id="datatable" class="display">
	<thead>
		<tr>
			{% for pair in site.data.database[0] %}
				<th>{{ pair[0] }}</th>
			{% endfor %}
		</tr>
	</thead>
	<tbody>
	{% for row in site.data.database %}
		<tr>
			{% for pair in row %}
				<td>{{ pair[1] }}</td>
			{% endfor %}
		</tr>
	{% endfor %}
	</tbody>
</table>

<!--Dynamic table using js-->
<script>
function numberToLaTeX(value) {

	let num = parseFloat(value);

	// If not a number, do nothing
    if (isNaN(num) || value === null || value.trim() === "") {
        return value;
    }

	// If zero, return zero
    if (num === 0) {
        return "$0$";
    }

    // Convert the number to a scientific notation
    let scientificString = num.toExponential(2);

    // Regex to extract mantissa, exponent sign, and exponent value.
    let parts = scientificString.match(/^(-?\d+\.?\d*)[eE]([+-]?)(\d+)$/);
    
    // If fails, return value
    if (!parts) {
    	return value;
    }

    let mantissa = parts[1];
	let sign = parts[2];
	let exponent = parseInt(parts[3], 10);

    // If the exponet is zero, return just the mantisa
    if (exponent === 0) {
        return `$${mantissa}$`;
    }

    let latexExponentStr = exponent.toString();
    if (sign === '-') {
        latexExponentStr = '-' + latexExponentStr;
    }

    return `$${mantissa} \\times 10^{${latexExponentStr}}$`;
}

$(document).ready(function() {

	//Columns which filter button
	var filterColumnIndexes = [0, 1];
	
	//First numeric column
	var firstNumColumn = 2;
	
	//Number of rows entries per page
	var rowsPerPage = 30;

	//Dynamic table rendering
	var table = $('#datatable').DataTable({
		
		"lengthChange": false,
		"pageLength": rowsPerPage,
		
		"drawCallback": function(settings) {
			var api = this.api();

			api.rows({ page: 'current' }).every(function() {
				var rowNode = this.node();

				api.cells(rowNode, '').every(function(cellInfo) {
					if (cellInfo.column >= firstNumColumn) {
						var originalData = this.data();
						var formattedData = numberToLaTeX(originalData);
						$(this.node()).html(formattedData);
					}
				});
			});
			
			if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
				MathJax.typesetPromise([api.table().node()]).catch(function(err) {
					console.error("MathJax typesetting error:", err);
				});
			} 
			
		},

		initComplete: function () {
		
			var api = this.api();
			var thead = $(api.table().header());
			var filterRow = $('<tr>').appendTo(thead);

			api.columns().every(function (colIdx) {
				var column = this;
				var headerText = $(column.header()).text();
				var filterCell = $('<th>').appendTo(filterRow);

				if (filterColumnIndexes.includes(colIdx)) {
					var select = $('<select><option value="">All ' + headerText + '</option></select>')
						.appendTo(filterCell)
						.on('change', function () {
							var val = $(this).val();
							column
								.search(val ? '^' + val + '$' : '', true, false)
								.draw();
						});
					column
						.data()
						.unique()
						.sort()
						.each(function (d, j) {
							select.append(
								'<option value="' + d + '">' + d + '</option>'
							);
						});
				} else {
					filterCell.html('&nbsp;');
				}
			});
		}

 	});
 
 });
</script>
